rules = hancho.load("rules/rules.hancho")

def build_lib(name):
  return rules.cpp_lib(
    source_files = hancho.glob(f"metrolib/{name}/*.cpp"),
    build_files  = f"metrolib/{name}/lib{name}.a",
    defines      = ["CONFIG_DEBUG"],
    includes     = [".", "symlinks"],
    warnings     = ["unused-variable", "error"],

  )

export.rules      = rules
export.libappbase = build_lib("appbase")
export.libaudio   = build_lib("audio")
export.libcore    = build_lib("core")
export.libgameboy = build_lib("gameboy")

elf_to_hex_bin = rules.cpp_bin("metrolib/tools/elf_to_hex.cpp", "metrolib/tools/elf_to_hex")

export.elf_to_hex = hancho.command(
  "{command_files} {rel_source_files} {rel_build_files}",
  command_files = elf_to_hex_bin,
)

test_elf_to_hex = export.elf_to_hex(
  "tests/add.elf",
  ["tests/add.code.vh", "tests/add.rwdata.vh"],
  quiet=True,
)
